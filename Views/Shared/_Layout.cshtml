@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@using WebBanHang.Models
@using WebBanHang.Helpers
@{
    var cart = Context.Session.GetObjectFromJson<List<CartItem>>("CartSession") ?? new List<CartItem>();
    int totalQuantity = cart.Sum(item => item.Quantity);
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - ElectroShop</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/WebBanHang.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
</head>

<body>
    <!-- AJAX (Asynchronous JavaScript and XML) là một tập hợp các kỹ thuật phát triển web cho phép một trang web giao tiếp với máy chủ (server) trong nền mà không cần phải tải lại toàn bộ trang.Nói một cách đơn giản, AJAX giúp cập nhật một phần của trang web với dữ liệu mới mà không làm gián đoạn trải nghiệm của người dùng. -->
    <header>
        <nav class="navbar navbar-expand-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div class="container-fluid">
                <a class="navbar-brand" asp-controller="Home" asp-action="Index">ElectroShop</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
                    aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="mainNavbar">
                    <ul class="navbar-nav me-auto mb-2 mb-sm-0">
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-controller="Home" asp-action="Index">Trang chủ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-page="/Privacy">Chính sách</a>
                        </li>
                    </ul>

                    <ul class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item position-relative">
                            <a class="nav-link text-dark" asp-controller="Cart" asp-action="Index">
                                🛒 Giỏ hàng
                                @if (totalQuantity > 0)
                                {
                                    <span
                                        class="position-absolute top-10 start-90 translate-middle badge rounded-pill bg-danger">
                                        @totalQuantity
                                    </span>
                                }
                            </a>
                        </li>

                        @if (HttpContextAccessor.HttpContext.Session.GetString("Username") != null)
                        {
                            <li class="nav-item dropdown">
                                <a class="nav-link text-dark dropdown-toggle" href="#" id="userDropdown" role="button"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Xin chào, @HttpContextAccessor.HttpContext.Session.GetString("Username")
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                    <li>
                                        <a class="dropdown-item" asp-controller="Account" asp-action="Profile">Hồ sơ</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" asp-controller="Account" asp-action="MyOrders">Đơn hàng của
                                            tôi</a>
                                    </li>
                                    @if (HttpContextAccessor.HttpContext.Session.GetString("Role") == "Admin")
                                    {
                                        <li>
                                            <a class="dropdown-item" asp-controller="Admin" asp-action="Index">Trang quản
                                                trị</a>
                                        </li>
                                    }
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li>
                                        <a class="dropdown-item" asp-controller="Account" asp-action="Logout">Đăng xuất</a>
                                    </li>
                                </ul>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item">
                                <a class="nav-link text-dark" asp-controller="Account" asp-action="Login">Đăng nhập</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-dark" asp-controller="Account" asp-action="Register">Đăng ký</a>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="text-light py-5 mt-5" style="background-color: #1a1a1a; border-top: 3px solid #e60012;">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5 class="text-uppercase text-danger">ElectroShop</h5>
                    <p>Chuyên cung cấp máy tính, gaming gear và phụ kiện công nghệ chất lượng.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h6 class="text-uppercase">Liên hệ</h6>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-geo-alt-fill"></i> 806 QL22, ấp Mỹ Hoà 3, Hóc Môn, Hồ Chí Minh</li>
                        <li><i class="bi bi-telephone-fill"></i> 0903050953</li>
                        <li><i class="bi bi-envelope-fill"></i> support@electroshop.vn</li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h6 class="text-uppercase">Chính sách</h6>
                    <ul class="list-unstyled">
                        <li><a class="text-light text-decoration-none" asp-controller="Home" asp-action="Privacy">Chính
                                sách bảo mật</a></li>
                        <li><a class="text-light text-decoration-none" asp-controller="Home"
                                asp-action="ReturnPolicy">Đổi trả</a></li>
                        <li><a class="text-light text-decoration-none" asp-controller="Home" asp-action="Warranty">Bảo
                                hành</a></li>
                    </ul>
                    <h6 class="mt-3 text-uppercase">Kết nối</h6>
                    <a href="#" class="text-light me-3"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="text-light me-3"><i class="bi bi-youtube"></i></a>
                    <a href="#" class="text-light"><i class="bi bi-instagram"></i></a>
                </div>
            </div>
            <hr style="border-top: 1px solid #444;">
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>

</html>