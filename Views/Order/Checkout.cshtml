@model WebBanHang.Models.CheckoutViewModel

@{
    ViewData["Title"] = "Xác nhận Thanh toán";
}

<style>
    body {
        background-color: #1a1a1a;
        color: #f8f9fa;
    }

    /* Style chung */
    .section-title {
        color: white; font-weight: 600; margin-bottom: 2rem;
    }
    .btn-custom-red {
        background-color: #d9232d; border-color: #d9232d; color: white;
        padding: 14px 25px; font-weight: 600; font-size: 1.1rem; border-radius: 12px;
        text-transform: uppercase;
    }
    .btn-custom-red:hover {
        background-color: #b01c24; border-color: #a51a21; color: white;
    }

    .checkout-card {
        background-color: #2c2c2c;
        border-radius: 16px;
        padding: 2rem;
        height: 100%;
    }

    /* Thông tin giao hàng */
    .info-group {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
    }
    .info-group i {
        font-size: 1.2rem;
        color: #adb5bd;
        margin-right: 1rem;
        margin-top: 0.25rem;
        width: 20px;
    }
    .info-label {
        font-weight: 500;
        color: #adb5bd;
    }

    /* Tóm tắt giỏ hàng trong trang checkout */
    .order-summary-item {
        display: flex;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid #4a4a4a;
    }
    .order-summary-item:last-of-type { border-bottom: none; }
    .order-summary-item .text-muted {
        color: #ffffff;
        font-size: 0.9rem;
    }
    .order-summary-item img {
        width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 1rem;
    }
    .order-summary-details { flex-grow: 1; }
    .order-summary-price { text-align: right; font-weight: 500; }
    
    /* Lựa chọn phương thức thanh toán */
    .payment-option {
        border: 1px solid #4a4a4a;
        border-radius: 12px;
        padding: 1.25rem;
        cursor: pointer;
        transition: border-color 0.2s;
    }
    .payment-option label {
        cursor: pointer;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-weight: 500;
    }
    .payment-option input[type="radio"] {
        display: none;
    }
    .payment-option label::before {
        content: '';
        display: inline-block;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #555;
        margin-right: 1rem;
        transition: border-color 0.2s, background-color 0.2s;
    }
    .payment-option input[type="radio"]:checked + label {
        color: white;
    }
    .payment-option input[type="radio"]:checked + label::before {
        border-color: #d9232d;
        background-color: #d9232d;
        box-shadow: inset 0 0 0 3px #2c2c2c;
    }
    .payment-option:hover {
        border-color: #777;
    }
    
    .final-summary-row {
        display: flex; justify-content: space-between; padding: 0.75rem 0;
    }
    .grand-total-label { font-size: 1.25rem; font-weight: bold; }
    .grand-total-value { font-size: 1.25rem; font-weight: bold; color: #20c997; }

</style>

<div class="container my-5">
    <h2 class="section-title">Xác nhận Thanh toán</h2>
    <div class="row">
        <div class="col-lg-7 mb-4">
            <div class="checkout-card">
                <h4 class="mb-4">Thông tin giao hàng</h4>
                <div class="info-group">
                    <i class="bi bi-person-fill"></i>
                    <div>
                        <div class="info-label">Tên khách hàng</div>
                        <div>@Model.CustomerName</div>
                    </div>
                </div>
                <div class="info-group">
                    <i class="bi bi-telephone-fill"></i>
                    <div>
                        <div class="info-label">Số điện thoại</div>
                        <div>@Model.Phone</div>
                    </div>
                </div>
                <div class="info-group">
                    <i class="bi bi-geo-alt-fill"></i>
                    <div>
                        <div class="info-label">Địa chỉ giao hàng</div>
                        <div>@Model.Address</div>
                    </div>
                </div>

                <hr class="my-4" style="border-color: #4a4a4a;"/>

                <h4 class="mb-3">Giỏ hàng của bạn</h4>
                @foreach (var item in Model.CartItems)
                {
                    <div class="order-summary-item">
                        <img src="@item.ImageUrl" alt="@item.ProductName" />
                        <div class="order-summary-details">
                            <div>@item.ProductName</div>
                            <div class="text-muted">Số lượng: @item.Quantity</div>
                        </div>
                        <div class="order-summary-price">
                            @((item.Quantity * (item.Price ?? 0)).ToString("N0")) VNĐ
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="col-lg-5 mb-4">
            <div class="checkout-card">
                <h4 class="mb-4">Chọn phương thức thanh toán</h4>
                
                <form asp-action="Checkout" method="post">
                    
                    <input type="hidden" asp-for="CustomerName" />
                    <input type="hidden" asp-for="Phone" />
                    <input type="hidden" asp-for="Address" />

                    <div class="payment-option mb-3">
                        <input class="form-check-input" type="radio" name="PaymentMethod" id="cod" value="COD" checked>
                        <label class="form-check-label" for="cod">
                            <span>Thanh toán khi nhận hàng (COD)</span>
                            <i class="bi bi-truck"></i>
                        </label>
                    </div>
                    <div class="payment-option mb-3">
                        <input class="form-check-input" type="radio" name="PaymentMethod" id="vnpay" value="VNPAY">
                        <label class="form-check-label" for="vnpay">
                            <span>Thanh toán qua VNPAY</span>
                            <img src="~/Image/vnpay.png" style="height: 25px;" />
                        </label>
                    </div>
                    
                    <hr class="my-4" style="border-color: #4a4a4a;"/>

                    <div class="final-summary-row">
                        <span>Tạm tính</span>
                        <strong>@Model.SubTotal.ToString("N0") VNĐ</strong>
                    </div>

                    @if (Model.DiscountAmount > 0)
                    {
                        <div class="final-summary-row text-success">
                            <span>Giảm giá</span>
                            <strong>-@Model.DiscountAmount.ToString("N0") ₫</strong>
                        </div>
                    }

                    <div class="final-summary-row mt-2">
                        <span class="grand-total-label">Thành tiền</span>
                        <span class="grand-total-value">@Model.GrandTotal.ToString("N0") VNĐ</span>
                    </div>

                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-custom-red">Xác nhận thanh toán</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>